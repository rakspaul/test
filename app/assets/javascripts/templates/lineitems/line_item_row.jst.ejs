<div class="ad-type-dropdown">
  <div class="li-commands-btn pull-left" title="Create Ad" id="adTypeDropdown" data-toggle="dropdown">
  </div>
  <div class="li-duplicate-btn pull-left" style="display:none;" title="Duplicate LI"></div>
  <div class="li-delete-btn delete-btn pull-left" style="display:none;" title="Delete LI"></div>
  <ul class="dropdown-menu types-dropdown" role="menu" aria-labelledby="adTypeDropdown">
    <% if (lineitem.type == 'Display') { %>
    <li role="presentation"><a class="li-add-ad-btn" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="Display">Create DFP Ad</a></li>
    <% } %>
    <% if (platforms && platforms.length > 0) { %>
      <% type_platforms = platforms.findByType(lineitem.type) %>
      <% for (var i in type_platforms) { %>
        <% platform = type_platforms[i].attributes %>
        <li role="presentation"><a class="li-add-ad-btn" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="<%= platform.media_type %>" data-platform-id="<%= platform.id %>">Create <%= platform.name %> Ad</a></li>
      <% } %>
    <% } %>
  </ul>
</div>

<div class="li-table">
  <div class="li-row">
    <div class="pure-u-1-12 li-number <%= lineitem.revised === true ? 'revised':'' %> <%= lineitem.active === true ? 'active':'inactive' %>">
      <span><%= localise(i18n_identifier + '.contract_li') %></span>
      <div style="clear:both"></div>
      <span class="item-number"><%= lineitem.alt_ad_id || lineitem.itemIndex %></span><br/>

      <div class="revised-dialog" style="display:none">
        <span class="accept-all-btn"><span class="accept-img"/>Accept All Revisions</span>
        <span class="decline-all-btn"><span class="decline-img"/>Decline All Revisions</span>
      </div>
    </div>

    <% wrong_start_date = !lineitem.order_id && moment(ReachUI.currentTimeWithOffset("-5h")).format("YYYY-MM-DD") > lineitem.start_date %>
    <div class="pure-u-1-12 start-date<% if (wrong_start_date) { %> field_with_errors<% } %>">
      <span class="editable start-date-editable" data-type="date" data-name="start_date" data-date-format="yyyy-mm-dd" data-pk="1" contenteditable="true">
        <%= lineitem.start_date %>
      </span>
      <% if(lineitem.revised_start_date) { %>
        <div style="clear:both"></div>
        <span class="revision"><%= lineitem.revised_start_date %></span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="start_date"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="start_date"><span class="decline-img"/>Decline</span>
        </div>
      <% } %>
      <div style="clear:both"></div>
      <div class="errors_container">
        <% if (wrong_start_date) { %>
        Start date cannot be in the past
        <% } %>
      </div>
      <% if(lineitem.dfp_url && lineitem.dfp_url != '') { %>
        <div class="client-id">Client Id: <a href="<%= lineitem.dfp_url %>" target="_blank"><%= lineitem.li_id %></a></div>
      <% } else if(lineitem.li_id && lineitem.li_id!="") {%>
        <div class="client-id">Client Id: <%= lineitem.li_id %></div>
      <% } %>
    </div>

    <% wrong_end_date = !lineitem.order_id && moment(ReachUI.currentTimeWithOffset("-5h")).format("YYYY-MM-DD") > lineitem.end_date %>
    <div class="pure-u-1-12 end-date<% if (wrong_end_date) { %> field_with_errors<% } %>">
      <span class="editable end-date-editable" data-type="date" data-name="end_date" data-date-format="yyyy-mm-dd" data-pk="1" contenteditable="true">
        <%= lineitem.end_date %>
      </span>
      <% if(lineitem.revised_end_date) { %>
        <div style="clear:both"></div>
        <span class="revision"><%= lineitem.revised_end_date %></span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="end_date"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="end_date"><span class="decline-img"/>Decline</span>
        </div>
      <% } %>
      <div style="clear:both"></div>
      <div class="errors_container">
        <% if (wrong_end_date) { %>
        End date cannot be in the past
        <% } %>
      </div>
    </div>

    <div class="pure-u-1-6 lineitem-sizes">
      <div class="dropdown">
        <div class="<%= lineitem.type.toLowerCase() %>-icon pull-left media-type-pointer" title="Media Type" id="changeTypeDropdown" data-toggle="dropdown">
        </div>
        <ul class="dropdown-menu types-dropdown" role="menu" aria-labelledby="changeTypeDropdown">
          <li role="presentation">
            <a class="change-media-type" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="Display"><span class="display-icon pull-left"></span>Display</a>
          </li>
          <li role="presentation">
            <a class="change-media-type" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="Video"><span class="video-icon pull-left"></span>Video</a>
          </li>
          <li role="presentation">
            <a class="change-media-type" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="Mobile"><span class="mobile-icon pull-left"></span>Mobile</a>
          </li>
          <li role="presentation">
            <a class="change-media-type" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="Facebook"><span class="facebook-icon pull-left"></span>Facebook</a>
          </li>
        </ul>
      </div>
      <% if(lineitem.revised_common_ad_sizes || lineitem.revised_added_ad_sizes || lineitem.revised_removed_ad_sizes) { %>
        <div style="clear:both"></div>
        <span class="editable editable-click" data-type="select2" data-name="lineitem-sizes" data-pk="1">
          <%= lineitem.revised_common_ad_sizes.join(', ') %>
        </span>
        <span class="revision">
          <%= lineitem.revised_added_ad_sizes %>
          <span class="line-through"><%= lineitem.revised_removed_ad_sizes %></span>
        </span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="ad_sizes"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="ad_sizes"><span class="decline-img"/>Decline</span>
        </div>
      <% } else { %>
        <span class="editable editable-click" data-type="select2" data-name="lineitem-sizes" data-pk="1">
          <%= lineitem.ad_sizes.replace(/,/gi, ', ') %>
        </span>        
      <% } %>
      <div class="errors_container"></div>
      <br/>
      <span class="toggle-creatives-btn operation"><span class="pencil-icon"></span>Edit Creatives (<%= lineitem.creatives.length %>)</span>
    </div>

    <div class="pure-u-1-3 name">
      <span class="editable name-editable" data-type="text" data-name="name" data-pk="1" data-inputclass="wide-editable-text" contenteditable="true">
        <%= lineitem.name %>
      </span>

      <% if(lineitem.revised_name) { %>
        <div style="clear:both"></div>
        <span class="revision"><%= lineitem.revised_name %></span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="name"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="name"><span class="decline-img"/>Decline</span>
        </div>
      <% } %>
      <div style="clear:both"></div>

      <span class="editable notes notes-editable" data-type="text" data-name="name" data-pk="1" data-inputclass="wide-editable-text" title="Line item notes">
        <%= lineitem.notes %>
      </span>

      <div class="errors_container" style="clear:both">
        <% if(lineitem.name.length > 500) { %>
        Lineitem name should be less than 500 characters
        <% } %>
      </div>
      <br/>
      <span class="toggle-targeting-btn operation">+ Add Targeting</span>
      <div class="targeting_options_condensed" style="clear:both"></div>
    </div>

    <div class="pure-u-1-12 volume number-field">
      <span class="editable volume-editable" data-type="text" data-name="volume" data-pk="1" contenteditable="true">
        <%= lineitem.volume %>
      </span>
      <% if(lineitem.revised_volume != null) { %>
        <div style="clear:both"></div>
        <span class="revision"><%= accounting.formatNumber(lineitem.revised_volume) %></span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="volume"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="volume"><span class="decline-img"/>Decline</span>
        </div>
      <% } %>
      <div style="clear:both"></div>
      <div class="errors_container"></div>
      <span class="editable buffer-editable" data-type="text" data-name="buffer" data-pk="1" contenteditable="true">
        <%= lineitem.buffer %>
      </span>%
    </div>
    <div class="pure-u-1-12 rate number-field">
      $<span class="editable rate-editable" data-type="text" data-name="rate" data-pk="1" contenteditable="true">
        <%= lineitem.rate %>
      </span>
      <% if(lineitem.revised_rate != null) { %>
        <div style="clear:both"></div>
        <span class="revision"><%= accounting.formatMoney(lineitem.revised_rate, '') %></span>
        <div class="revised-dialog" style="display:none">
          <span class="accept-btn" data-name="rate"><span class="accept-img"/>Accept</span>
          <span class="decline-btn" data-name="rate"><span class="decline-img"/>Decline</span>
        </div>
      <% } %>
      <div style="clear:both"></div>
      <div class="errors_container"></div>
    </div>

    <div class="pure-u-1-12 media-cost number-field">
      <span class="number-value">
        $<span class="media-cost-value"><%= accounting.formatMoney(lineitem.value, '') %></span>
      </span>
      <div class="errors_container"></div>
    </div>
  </div>

  <div class="pure-u-1 lineitem-status <%= lineitemStatusClass() %>" title="<%= lineitem.li_status%>">
    <%= lineitem.li_status%>
  </div>
</div>

<div class="targeting-container" style="display:none"></div>
<div style="clear:both"></div>

<div class="creatives-list-view" style="display:none"></div>
<div style="clear:both"></div>

<% if(false) { /* TODO: uncomment once implemented all necessary backend and JS parts */ %>
<div class="li-performance-container">
  <div class="pure-g-r">
    <div class="pure-u-1-12">
      <i class="graph-icon pull-right"></i>
    </div>
    <div class="pure-u-1-6">
      <div class="top-label-holder">
        <span>Total Imps.</span>
      </div>
      <div class="bar-container">
        <!-- TODO: Move into View initializing -->
        <% var li_stop_position = Math.round(4722655 * 100 / 5000000) %>
        <div class="progress-bar" style="background-image: linear-gradient(to right, #a5ccf9 <%= li_stop_position %>%, #fff <%= li_stop_position %>%);">
          4,722,655
        </div>
      </div>
    </div>
    <div class="pure-u-1-12">
      <span class="top-label-holder">Clicks</span>
      <div class="current-value">5,621</div>
    </div>
    <div class="pure-u-1-12">
      <span class="top-label-holder">CTR</span>
      <div class="current-value">0.22%</div>
    </div>
    <div class="pure-u-1-6">
      <div class="top-label-holder">
        <div class="pull-right">
          <i class="flag-icon"></i>
          <i class="alert-icon pull-right"></i>
        </div>
        <span>Revenue</span>
      </div>
      <div class="bar-container">
        <% var li_stop_position_2 = Math.round(14056 * 100 / 15000) %>
        <div class="progress-bar" style="background-image: linear-gradient(to right, #a5ccf9 <%= li_stop_position_2 %>%, #fff <%= li_stop_position_2 %>%);">
          $14,056
        </div>
      </div>
    </div>
    <div class="pure-u-1-24">
      <span class="top-label-holder">Margin</span>
      <div class="current-value">46%</div>
    </div>
    <div class="pure-u-1-6 last-update-info-container">
      Last update <span class="last-update-info">6 days ago</span>
      <button class="rui-btn update-li-metrics">
        <i class="pencil-icon"></i>&nbsp;Update
      </button>
    </div>
    <div class="pure-u-1-5">
      <button class="rui-btn li-add-3dp-data pull-right">
        <i class="plus-icon"></i> Add 3rd Party Data
      </button>
    </div>
  </div>
  <!-- Table with expected metrics -->
  <div class="expected-metrics-container">
    <div class="pure-g">
      <div class="pure-u-1-12"><!-- Just a spacer column //--></div>
      <div class="pure-u-1-2">
        <div class="pull-left bordered">
          <table class="pure-table pure-table-horizontal rui-pure-table metrics-table">
            <thead>
              <tr>
                <th>&nbsp;</th>
                <th>Date</th>
                <th>Total Imps</th>
                <th>Clicks</th>
                <th>CTR</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td colspan="5">
                  <button class="rui-btn add-record-btn semi-transparent">+ Add Record</button>
                  <button class="rui-btn add-metric-btn semi-transparent">
                    <i class="plus-icon"></i> Add Metric
                  </button>
                  <button class="rui-btn rui-btn-blue pull-right semi-transparent">Done</button>
                </td>
              </tr>
            </tfoot>
            <tbody>
              <tr class="template">
                <td><button class="rui-btn" title="Remove"><i class="cross"></i></button></td>
                <td>
                  <span class="editable popup" data-type="date" data-name="li_metrics_milestone_date" data-date-format="yyyy-mm-dd" data-pk="1"></span>
                </td>
                <td>
                  <div class="semi-bordered wrapper pull-right">
                    <div class="fake-input">
                      <input type="text" name="li_<%= lineitem.id %>_total_imps">
                    </div>
                  </div>
                </td>
                <td>
                  <div class="semi-bordered wrapper pull-right">
                    <div class="fake-input">
                      <input type="text" name="li_<%= lineitem.id %>_clicks">
                    </div>
                  </div>
                </td>
                <td>n/a</td>
              </tr>
              <tr>
                <td><button class="rui-btn" title="Remove"><i class="cross"></i></button></td>
                <td>
                  <span class="editable custom" data-type="date" data-name="li_metrics_milestone_date" data-date-format="yyyy-mm-dd" data-pk="1"></span>
                </td>
                <td>
                  <div class="semi-bordered wrapper pull-right">
                    <div class="fake-input">
                      <input type="text" name="li_<%= lineitem.id %>_total_imps">
                    </div>
                  </div>
                </td>
                <td>
                  <div class="semi-bordered wrapper pull-right">
                    <div class="fake-input">
                      <input type="text" name="li_<%= lineitem.id %>_clicks">
                    </div>
                  </div>
                </td>
                <td>n/a</td>
              </tr>
              <tr>
                <td><button class="rui-btn" title="Remove"><i class="cross"></i></button></td>
                <td>06/27/2014</td>
                <td>3,514,200</td>
                <td>4,023</td>
                <td>0.37%</td>
              </tr>
              <tr>
                <td><button class="rui-btn" title="Remove"><i class="cross"></i></button></td>
                <td>05/12/2014</td>
                <td>1,150,017</td>
                <td>2,545</td>
                <td>0.24%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<% } %>

<div class="ads-container"></div>
<div style="clear:both"></div>

<div class="copy-targeting-btn dropdown" style="display:none">
  <div data-toggle="dropdown" id="copyTargeting">Copy</div>
    <ul class="dropdown-menu copy-targeting-dropdown list-inline" role="menu" aria-labelledby="copyTargeting">
      <li role="presentation"><a class="copy-targeting-item" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="key_values">KVs</a></li>
      <li role="presentation"><a class="copy-targeting-item" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="geo">Geo</a></li>
      <li role="presentation"><a class="copy-targeting-item" role="menuitem" tabindex="-1" href="javascript:void(0)" data-type="freq_cap">Freq Cap</a></li>
    </ul>
  </div>
</div>

<div class="paste-targeting-btn" style="display:none">Paste Targeting</div>
<div class="cancel-targeting-btn" style="display:none">Cancel</div>

<div class="unallocated-imps pure-g">
  <div class="unallocated-imps-caption pure-u-1-6 pull-right">Unallocated impressions</div>
  <div class="unallocated-imps-value pure-u-1-12 pull-right">0</div>
</div>
<script type="text/javascript">
  $(function(){
    $('[data-name="li_metrics_milestone_date"]').editable({
      format: 'yyyy-mm-dd',
      viewformat: 'dd/mm/yyyy',
      datepicker: {
        weekStart: 1
      }
    });
  });
</script>
