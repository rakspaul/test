(function(){commonModule.controller("ganttChartController",function($scope,$location,ganttChart,ganttChartModel,constants,brandsModel,loginModel,analytics){$scope.init=function(update){$scope.calendarBusy=true;$scope.selected="quarter";ganttChartModel.getGanttChartData().then(function(result){$scope.calendarBusy=false;$scope.noData=false;var brands=[];var campaigns=[];var count=0;var limit=5;if(result!=undefined&&result.brands!=undefined&&result.brands.length>0){$scope.noData=false;_.each(result.brands,
function(datum){var space=0;for(space=0;space<=1;space++){count++;var c={};c.id=count;c.name=" ";c.type="brand";c.status="";c.taskName=count;c.startDate=moment().subtract(2,"years").startOf("year");c.endDate=moment().add(2,"years").endOf("year");campaigns.push(c);brands.push(count)}count++;c={};c.id=datum.id;c.name=datum.name;c.type="brand";c.status="";c.taskName=count;c.startDate=moment().subtract(2,"years").startOf("year");c.endDate=moment().add(2,"years").endOf("year");campaigns.push(c);brands.push(count);
_.each(datum.campaigns,function(tasks){count++;var c={};c.id=tasks.id;c.name=tasks.name;c.startDate=moment(tasks.start_date).startOf("day");c.endDate=moment(tasks.end_date).endOf("day");c.state=tasks.state;c.kpiStatus=tasks.kpi_status;c.taskName=count;brands.push(count);campaigns.push(c)})});if(brandsModel.getSelectedBrand().id==-1)ganttChart.newCalendar(campaigns,brands);else if(update||brandsModel.getSelectedBrand().id)ganttChart.newCalendar(campaigns,brands,true)}else $scope.noData=true})};$scope.add=
function(){ganttChart.addTask()};$scope.prev=function(){ganttChart.prev($scope.selected)};$scope.next=function(){ganttChart.next($scope.selected)};$scope.month=function(){$scope.selected="month";analytics.track(loginModel.getUserRole(),"dashboard_calendar_widget","date_type_month_selected",loginModel.getLoginName());ganttChart.month()};$scope.today=function(){$scope.selected="today";analytics.track(loginModel.getUserRole(),"dashboard_calendar_widget","date_type_week_selected",loginModel.getLoginName());
ganttChart.today()};$scope.quarter=function(){$scope.selected="quarter";analytics.track(loginModel.getUserRole(),"dashboard_calendar_widget","date_type_quarter_selected",loginModel.getLoginName());ganttChart.quarter()};$scope.year=function(){$scope.selected="year";analytics.track(loginModel.getUserRole(),"dashboard_calendar_widget","date_type_year_selected",loginModel.getLoginName());ganttChart.year()};$scope.init();$scope.$on(constants.EVENT_BRAND_CHANGED,function(event,args){$(".chart").remove();
$scope.selected="quarter";if(brandsModel.getSelectedBrand().id==-1)$scope.init();else $scope.init("single_brand")})})})();